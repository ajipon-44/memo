# フロントエンド開発のためのテスト入門

## 第１章　テストの目的と障壁

リグレッションテスト ... デグレのテストのこと
E2E テスト ... クライアントから DB サーバまで含んだテスト、実際の Web アプリケーションに近い状況を再現する

### テストを書く目的

1. バグを減らすため
2. リファクタリングを容易に行い、コードの品質を高く維持するため
   1. リファクタリングによって悪影響がないかすぐに調べられる
3. アクセシビリティの向上
   1. テストコードはアクセシビリティ由来の要素取得 AI を利用してテストを書くことが増えたので、自ずとアクセシビリティを担保したコードになる
4. コミュニケーションの円滑化
   1. プルリクを出した時にレビュワーがどのような仕様で作った機能なのかが、テストに書いてあるのでわかりやすい
5. デグレを防ぐため

### テストを書く障壁

1. テストを書かない風土
   1. 自分がテストを書けば、それを真似する人が出てくるかも
2. 時間がない
   1. テストを書かない方がバグを生むし、それによる手戻りを考えると、テストを書く方が時間効率が良い

## 第２章　テスト手法とテスト戦略

### 範囲と目的で考えるテスト

#### テストの範囲

フロントエンドの自動テストでは、以下のどこからどこまでを対象とするかを考える。

1. ライブラリが提供する関数
2. ロジックを担う関数
3. UI を表現する関数
4. Web API クライアント
5. API サーバ
6. DB サーバ

#### 静的解析

TypeScript や ESLint による静的解析
1 つ 1 つのモジュール検証だけでなく、2 と 3 といった**「隣接するモジュール間の不整合」**も検出できる

#### 単体テスト

2 のみ、3 のみというように、**「モジュール単体が提供する機能」**に着目したテスト
独立した検証が行えるため、アプリケーション稼働時には滅多に発生しないケース（コーナーケース）の検証に向いている
Jest や Testing Library を使う

#### 結合テスト

1~4 まで、2~3 までというように**「モジュールをつなげることで提供できる機能」**に着目したテスト
広範囲の対象を効率よくテストできるが、ざっくりした検証になる傾向がある
モックやスタブを多用して、外部依存を除外しながら「連携部分の挙動」を検証する
E2E テストとの境界が曖昧になりがちなので、モジュール単位〜ページ単位くらいが適切

#### E2E テスト

1~6 を通し、ヘッドレスブラウザ（見た目を提供しないブラウザ）と UI オートメーション（クリックなどの人の動作を自動化する）で実施するテスト
最も広範囲なテストであり、アプリ稼働状況に忠実なテスト

| テスト種別 | 対象範囲           | 特徴                       |
| ---------- | ------------------ | -------------------------- |
| 静的解析   | 型・文法・隣接関係 | 実行なしで問題検出         |
| 単体テスト | モジュール単体     | 小規模・細かな動作確認     |
| 結合テスト | モジュール間連携   | 中規模・連携の確認         |
| E2E テスト | 実アプリの全体     | 実際の挙動に近い・コスト高 |

### テストの目的

ソフトウェアテストは主に、機能テスト、非機能テスト、リグレッションテスト、ホワイトボックステストに分類される。
Web フロントエンドテストでは以下の 3 つが代表的。

#### 機能テスト（インタラクションテスト）

開発対象に不具合がないかを見るテスト。
フロントエンドの場合、インタラクション（クリックなどユーザの操作）のテストが主になる。
ブラウザの API を利用する場合、ヘッドレスブラウザや UI オートメーションを組み合わせる。

#### 非機能テスト（アクセシビリティテスト）

心身特性に隔てのない製品を提供できているかを測るテスト。

#### リグレッションテスト

デグレを見るテスト

### テスト戦略

単体テスト > 結合テスト > E2E テスト で項目数が多くなるように心がける
理由はテストにかかるコストは E2E テストが１番重いから
